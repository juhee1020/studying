package com.lec.web.service;
import java.sql.*;
import java.util.*;

import com.lec.web.dao.MessageDAO;
import com.lec.web.exception.*;
import com.lec.web.jdbc.*;
import com.lec.web.model.Message;

public class GetMessageListService {
	// 싱글톤으로 만들거다.
	
	// 기본생성자를 프라이빗으로 만든다.
	private GetMessageListService() {}

	private static GetMessageListService instance=new GetMessageListService();

	public static GetMessageListService getInstance() {
		return instance;
	}


	// 한페이지 당 10건씩 보여주기 위해서
	private static final int MESSAGE_COUNT_PER_PAGE=10;


	// 페이징
	public MessageListView getMessageList(int pageNumber) {
		Connection conn=null;
		int currentPage=pageNumber;
		
		//커넥션풀에서 사용가능한 Connection을 커넥션제공자에서 가져오기.
		try {
			conn= ConnectionProvider.getConnection();
			MessageDAO messageDAO=MessageDAO.getInstance();
			
			// 페이징처리
			int totalCount=messageDAO.selectCount(conn);
			
			List<Message> messageList=null;
			
			int start=0;
			int end=0;
			
			if(totalCount>0) {
				start=(pageNumber-1)*MESSAGE_COUNT_PER_PAGE;
				end=MESSAGE_COUNT_PER_PAGE;
				messageList=messageDAO.selectList(conn, start, end);
			}else{
				currentPage=0;
				messageList=Collections.emptyList(); // null과 같은의미
			}
			return new MessageListView();

		}catch(Exception e) {
			throw new ServiceException("메시지목록 가져오기실패");
		}finally {
			JDBCUtil.close(conn, null, null);
		}
	}
}